<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Share Your Beauty Experience - Beauty Insights</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'parchment': '#f6f2ea',
                        'leather': '#c29b87',
                        'oak': '#a97954',
                        'manuscript': '#1e423f',
                        'binding': '#532c2e',
                        'crimson': '#34000b'
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        .font-luxury { font-family: 'Playfair Display', serif; }
        .font-body { font-family: 'Inter', sans-serif; }
        .glass-nav {
            background: rgba(246, 242, 234, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(194, 155, 135, 0.2);
        }
        .gradient-bg {
            background: linear-gradient(135deg, #f6f2ea 0%, rgba(194, 155, 135, 0.3) 100%);
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(194, 155, 135, 0.2);
        }
        .rating-star {
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .rating-star:hover {
            transform: scale(1.2);
        }
        .rating-star.active {
            color: #a97954;
        }
        .btn-luxury {
            background: linear-gradient(135deg, #a97954 0%, #532c2e 100%);
            transition: all 0.3s ease;
        }
        .btn-luxury:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(83, 44, 46, 0.3);
        }
        .feedback-textarea {
            background: rgba(255, 255, 255, 0.8);
            border: 2px solid transparent;
            transition: all 0.3s ease;
            resize: none;
        }
        .feedback-textarea:focus {
            background: rgba(255, 255, 255, 1);
            border-color: #c29b87;
            box-shadow: 0 0 0 4px rgba(194, 155, 135, 0.1);
        }
        .floating-beauty {
            position: absolute;
            opacity: 0.1;
            animation: beautyFloat 15s infinite ease-in-out;
        }
        @keyframes beautyFloat {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen font-body">
    <!-- Navigation -->
    <nav class="glass-nav sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-6">
            <div class="flex justify-between items-center py-6">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-leather to-oak rounded-xl flex items-center justify-center">
                        <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                    </div>
                    <h1 class="text-2xl font-luxury font-bold text-manuscript">Beauty Insights</h1>
                </div>
                <div class="flex items-center space-x-6">
                    <a href="dashboard.html" class="text-manuscript hover:text-oak transition-colors font-medium">
                        <span class="flex items-center space-x-2">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
                            </svg>
                            <span>Analytics</span>
                        </span>
                    </a>
                    <button id="logoutButton" class="text-binding hover:text-crimson transition-colors font-medium">
                        <span class="flex items-center space-x-2">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M16 13v-2H7V8l-5 4 5 4v-3z"/>
                                <path d="M20 3h-9c-1.103 0-2 .897-2 2v4h2V5h9v14h-9v-4H9v4c0 1.103.897 2 2 2h9c1.103 0 2-.897 2-2V5c0-1.103-.897-2-2-2z"/>
                            </svg>
                            <span>Sign Out</span>
                        </span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-4xl mx-auto px-6 py-12 relative">
        <!-- Floating Beauty Elements -->
        <div class="floating-beauty top-20 left-10">
            <svg class="w-16 h-16 text-leather" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
        </div>
        <div class="floating-beauty top-40 right-20" style="animation-delay: -5s;">
            <svg class="w-12 h-12 text-oak" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
            </svg>
        </div>

        <!-- Header -->
        <div class="text-center mb-12">
            <h2 class="text-5xl font-luxury font-bold text-manuscript mb-4">Share Your Beauty Experience</h2>
            <p class="text-xl text-binding/80 font-light max-w-2xl mx-auto">
                Your feedback helps us create more beautiful moments. Tell us about your experience with our products.
            </p>
        </div>

        <!-- Feedback Form -->
        <div class="glass-card rounded-3xl p-10 shadow-2xl">
            <form id="feedbackForm" class="space-y-8">
                <!-- Feedback Text -->
                <div>
                    <label for="feedback" class="block text-manuscript font-luxury text-xl font-semibold mb-4">
                        Tell us about your experience
                    </label>
                    <div class="relative">
                        <textarea
                            id="feedback"
                            maxlength="500"
                            class="feedback-textarea w-full px-6 py-4 rounded-2xl focus:outline-none font-body text-manuscript placeholder-binding/50 min-h-[150px]"
                            placeholder="Share your thoughts about our products, application experience, colors, lasting power, or anything that matters to you..."
                            required
                        ></textarea>
                        <div class="absolute bottom-4 right-6 text-sm text-binding/60 font-body">
                            <span id="charCount">0</span>/500
                        </div>
                    </div>
                </div>

                <!-- Rating Section -->
                <div>
                    <label class="block text-manuscript font-luxury text-xl font-semibold mb-6">
                        How would you rate your experience?
                    </label>
                    <div class="flex items-center justify-center space-x-4 bg-white/50 rounded-2xl p-6">
                        <span class="text-binding/70 font-body">Poor</span>
                        <div class="flex space-x-2" id="ratingStars">
                            <svg class="rating-star w-10 h-10 text-gray-300" data-rating="1" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                            <svg class="rating-star w-10 h-10 text-gray-300" data-rating="2" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                            <svg class="rating-star w-10 h-10 text-gray-300" data-rating="3" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                            <svg class="rating-star w-10 h-10 text-gray-300" data-rating="4" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                            <svg class="rating-star w-10 h-10 text-gray-300" data-rating="5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                        </div>
                        <span class="text-binding/70 font-body">Excellent</span>
                    </div>
                    <input type="hidden" id="selectedRating" name="rating" required>
                </div>

                <!-- Submit Button -->
                <div class="text-center pt-6">
                    <button
                        type="submit"
                        class="btn-luxury px-12 py-4 text-white rounded-2xl font-luxury font-semibold text-lg tracking-wide"
                    >
                        Share My Experience
                    </button>
                </div>
            </form>

            <!-- Success/Error Messages -->
            <div id="successMessage" class="mt-8 p-6 bg-green-50 border border-green-200 rounded-2xl text-green-700 text-center hidden">
                <div class="flex items-center justify-center space-x-2">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    <span class="font-luxury text-lg">Thank you for your beautiful feedback!</span>
                </div>
            </div>
            <div id="errorMessage" class="mt-8 p-6 bg-red-50 border border-red-200 rounded-2xl text-red-600 text-center hidden font-body"></div>
        </div>
    </div>

    <script type="module">
        import { auth, db, collection, addDoc } from '../js/config.js';

        let selectedRating = 0;

        // Check if user is logged in
        auth.onAuthStateChanged((user) => {
            if (!user) {
                window.location.href = '../index.html';
            }
        });

        // Handle logout
        document.getElementById('logoutButton').addEventListener('click', async () => {
            try {
                await auth.signOut();
                window.location.href = '../index.html';
            } catch (error) {
                console.error('Error signing out:', error);
            }
        });

        // Rating stars functionality
        const stars = document.querySelectorAll('.rating-star');
        stars.forEach(star => {
            star.addEventListener('click', () => {
                selectedRating = parseInt(star.dataset.rating);
                document.getElementById('selectedRating').value = selectedRating;
                updateStars(selectedRating);
            });
            
            star.addEventListener('mouseenter', () => {
                const rating = parseInt(star.dataset.rating);
                updateStars(rating);
            });
        });

        document.getElementById('ratingStars').addEventListener('mouseleave', () => {
            updateStars(selectedRating);
        });

        function updateStars(rating) {
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.classList.add('active');
                    star.classList.remove('text-gray-300');
                } else {
                    star.classList.remove('active');
                    star.classList.add('text-gray-300');
                }
            });
        }

        // Character counter
        document.getElementById('feedback').addEventListener('input', (e) => {
            document.getElementById('charCount').textContent = e.target.value.length;
        });

        // Simple sentiment analysis function
        function analyzeSentiment(text, rating) {
            const positiveWords = ['love', 'amazing', 'beautiful', 'perfect', 'excellent', 'gorgeous', 'stunning', 'flawless', 'vibrant', 'smooth', 'creamy', 'long-lasting', 'pigmented'];
            const negativeWords = ['hate', 'awful', 'terrible', 'bad', 'poor', 'disappointing', 'cheap', 'patchy', 'dry', 'streaky', 'fading', 'chalky'];
            
            const words = text.toLowerCase().split(/\s+/);
            const positiveCount = words.filter(word => positiveWords.includes(word)).length;
            const negativeCount = words.filter(word => negativeWords.includes(word)).length;
            
            let sentiment = 'neutral';
            let score = 0.5;
            
            if (rating <= 2 || negativeCount > positiveCount) {
                sentiment = 'negative';
                score = 0.2;
            } else if (rating >= 4 || positiveCount > negativeCount) {
                sentiment = 'positive';
                score = 0.8;
            }
            
            return {
                sentiment: {
                    category: sentiment,
                    score: score,
                    magnitude: Math.abs(score - 0.5) * 2
                },
                keywords: words.filter(word => word.length > 3).slice(0, 5)
            };
        }

        // Handle form submission
        document.getElementById('feedbackForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const submitButton = e.target.querySelector('button[type="submit"]');
            const successMessage = document.getElementById('successMessage');
            const errorMessage = document.getElementById('errorMessage');
            const feedbackText = document.getElementById('feedback').value;
            const rating = selectedRating;

            if (!rating) {
                errorMessage.textContent = 'Please select a rating before submitting.';
                errorMessage.classList.remove('hidden');
                return;
            }

            try {
                submitButton.disabled = true;
                submitButton.innerHTML = `
                    <div class="flex items-center justify-center">
                        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        Processing Your Feedback...
                    </div>
                `;

                // Analyze feedback
                const analysis = analyzeSentiment(feedbackText, rating);

                // Save to local storage database
                const feedbackCollection = collection(db, 'feedback');
                await addDoc(feedbackCollection, {
                    text: feedbackText,
                    rating: rating,
                    sentiment: analysis.sentiment,
                    keywords: analysis.keywords,
                    timestamp: new Date().toISOString(),
                    userId: auth.currentUser?.uid || 'anonymous'
                });

                // Success animation
                submitButton.innerHTML = `
                    <div class="flex items-center justify-center">
                        <svg class="w-5 h-5 text-white mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                        </svg>
                        Feedback Submitted!
                    </div>
                `;

                // Show success message and reset form
                e.target.reset();
                document.getElementById('charCount').textContent = '0';
                selectedRating = 0;
                updateStars(0);
                document.getElementById('selectedRating').value = '';
                successMessage.classList.remove('hidden');
                errorMessage.classList.add('hidden');

                // Hide success message after 4 seconds
                setTimeout(() => {
                    successMessage.classList.add('hidden');
                    submitButton.innerHTML = 'Share My Experience';
                    submitButton.disabled = false;
                }, 4000);
            } catch (error) {
                console.error('Error submitting feedback:', error);
                errorMessage.textContent = error.message;
                errorMessage.classList.remove('hidden');
                successMessage.classList.add('hidden');
                submitButton.innerHTML = 'Share My Experience';
                submitButton.disabled = false;
            }
        });
    </script>
</body>
</html>